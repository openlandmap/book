<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5 OpenLandMap STAC | OpenLandMap Open Land Data services</title>
<meta name="author" content="OpenGeoHub foundation, GILAB.rs and contributors">
<meta name="description" content="You are reading the work-in-progress OpenLandMap.org Open Land Data Services. This chapter is currently draft version, a peer-review publication is pending. You can find the polished first edition...">
<meta name="generator" content="bookdown 0.37 with bs4_book()">
<meta property="og:title" content="5 OpenLandMap STAC | OpenLandMap Open Land Data services">
<meta property="og:type" content="book">
<meta property="og:url" content="https://openlandmap.github.io/book/openlandmap-stac.html">
<meta property="og:image" content="https://openlandmap.github.io/book/cover.png">
<meta property="og:description" content="You are reading the work-in-progress OpenLandMap.org Open Land Data Services. This chapter is currently draft version, a peer-review publication is pending. You can find the polished first edition...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="5 OpenLandMap STAC | OpenLandMap Open Land Data services">
<meta name="twitter:site" content="@opengeohub">
<meta name="twitter:description" content="You are reading the work-in-progress OpenLandMap.org Open Land Data Services. This chapter is currently draft version, a peer-review publication is pending. You can find the polished first edition...">
<meta name="twitter:image" content="https://openlandmap.github.io/book/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-06HBX7FM0K"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-06HBX7FM0K');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">OpenLandMap Open Land Data services</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li><a class="" href="new-to-markdown.html"><span class="header-section-number">2</span> New to markdown</a></li>
<li><a class="" href="compendium-of-global-gridded-environmental-data-sets.html"><span class="header-section-number">3</span> Compendium of Global Gridded Environmental Data Sets</a></li>
<li><a class="" href="openlandmap-layers.html"><span class="header-section-number">4</span> OpenLandMap layers</a></li>
<li><a class="active" href="openlandmap-stac.html"><span class="header-section-number">5</span> OpenLandMap STAC</a></li>
<li><a class="" href="references.html"><span class="header-section-number">6</span> References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/OpenLandMap/book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="openlandmap-stac" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> OpenLandMap STAC<a class="anchor" aria-label="anchor" href="#openlandmap-stac"><i class="fas fa-link"></i></a>
</h1>
<div class="rmdnote">
<p>You are reading the work-in-progress OpenLandMap.org Open Land Data Services. This chapter is currently draft version, a peer-review publication is pending. You can find the polished first edition at <a href="https://openlandmap.github.io/book/" class="uri">https://openlandmap.github.io/book/</a>.</p>
</div>
<div id="listing-layers" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Listing layers<a class="anchor" aria-label="anchor" href="#listing-layers"><i class="fas fa-link"></i></a>
</h2>
<p>Thanks to the STAC functionality and <code>rstac</code> package, it is possible to query directly
which collections are available on the stac.OpenLandMap.org (Note: some layers that
are available in STAC, might not be available in the front-end / web-GIS):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://brazil-data-cube.github.io/rstac/">rstac</a></span><span class="op">)</span></span>
<span><span class="va">olm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/static_functions.html">stac_read</a></span><span class="op">(</span><span class="st">"http://s3.eu-central-1.wasabisys.com/stac/openlandmap/catalog.json"</span><span class="op">)</span></span>
<span><span class="va">olm</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">###Catalog</span></span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">id:</span> openlandmap</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">description:</span> </span></span>
<span><span class="co">#&gt; Spatio-Temporal Asset Catalog for global layers provided by [OpenLandMap](https://openlandmap.org) and maintaned by [OpenGeoHub Foundation](https://opengeohub.org)</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">field(s):</span> type, id, stac_version, description, links, title</span></span></code></pre></div>
<p>To enumerate all available collections in the OpenLandMap catalog, we can scrutinize the links entry:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/static_functions.html">links</a></span><span class="op">(</span><span class="va">olm</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">###Links</span></span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">links</span> (74 entries(s)):</span></span>
<span><span class="co">#&gt;  1 <span style="font-weight: bold;">OpenLandMap STAC</span> (./catalog.json)</span></span>
<span><span class="co">#&gt;  2 <span style="font-weight: bold;">Sentinel-5P monthly tropospheric nitrogen dioxide density</span> </span></span>
<span><span class="co">#&gt; (./no2_s5p.l3.trop.tmwm/collection.json)</span></span>
<span><span class="co">#&gt;  3 <span style="font-weight: bold;">Sentinel-5P long-term tropospheric nitrogen dioxide density</span> </span></span>
<span><span class="co">#&gt; (./no2_s5p.l3.trop.tmwm.ltm/collection.json)</span></span>
<span><span class="co">#&gt;  4 <span style="font-weight: bold;">OpenLandMap annual soil organic carbon</span> </span></span>
<span><span class="co">#&gt; (./log.oc_iso.10694/collection.json)</span></span>
<span><span class="co">#&gt;  5 <span style="font-weight: bold;">MOD13Q1 long-term Enhanced Vegetation Index (EVI - trend analysis)</span> </span></span>
<span><span class="co">#&gt; (./evi_mod13q1.stl.trend.logit.ols.beta/collection.json)</span></span>
<span><span class="co">#&gt;  6 <span style="font-weight: bold;">ESA CCI annual land cover</span> </span></span>
<span><span class="co">#&gt; (./land.cover_esacci.lc.l4/collection.json)</span></span>
<span><span class="co">#&gt;  7 <span style="font-weight: bold;">MOD13Q1 bi-monthly Enhanced Vegetation Index Index (EVI)</span> </span></span>
<span><span class="co">#&gt; (./evi_mod13q1.tmwm.inpaint/collection.json)</span></span>
<span><span class="co">#&gt;  8 <span style="font-weight: bold;">OpenLandMap ensemble digital terrain model</span> </span></span>
<span><span class="co">#&gt; (./dtm.bareearth_ensemble/collection.json)</span></span>
<span><span class="co">#&gt;  9 </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Monthly fraction of absorbed photosynthetically active radiation (FAPAR)</span> </span></span>
<span><span class="co">#&gt; (./fapar_essd.lstm/collection.json)</span></span>
<span><span class="co">#&gt; 10 </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Long-term fraction of absorbed photosynthetically active radiation (FAPAR - trend analysis)</span> </span></span>
<span><span class="co">#&gt; (./fapar_essd.lstm.p95.beta/collection.json)</span></span>
<span><span class="co">#&gt;   ... with 64 more link(s).</span></span></code></pre></div>
<p>For instance, to compile a list of layers with the <code>title</code> containing the text <code>"GLC"</code> for land cover annual time-series, we can use:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/static_functions.html">links</a></span><span class="op">(</span><span class="va">olm</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"GLC"</span>, <span class="va">title</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">###Links</span></span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">links</span> (3 entries(s)):</span></span>
<span><span class="co">#&gt; 1 <span style="font-weight: bold;">UMD GLAD annual land cover and land use (GLCLUC)</span> </span></span>
<span><span class="co">#&gt; (./lc_glad.glcluc/collection.json)</span></span>
<span><span class="co">#&gt; 2 <span style="font-weight: bold;">UMD GLAD annual land cover and land use change (GLCLUC)</span> </span></span>
<span><span class="co">#&gt; (./lc_glad.glcluc.change/collection.json)</span></span>
<span><span class="co">#&gt; 3 <span style="font-weight: bold;">GLC_FCS30D annual land land-cover dynamic monitoring product</span> </span></span>
<span><span class="co">#&gt; (./lc_glc.fcs30d/collection.json)</span></span></code></pre></div>
<p>Let’s explore the third link, referencing the <code>GLC_FCS30D</code> annual land-cover dynamic monitoring product:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glc_link</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/static_functions.html">links</a></span><span class="op">(</span><span class="va">olm</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"GLC"</span>, <span class="va">title</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">glc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/static_functions.html">link_open</a></span><span class="op">(</span><span class="va">glc_link</span><span class="op">)</span></span>
<span><span class="va">glc</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">###Collection</span></span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">id:</span> lc_glc.fcs30d</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">title:</span> GLC_FCS30D annual land land-cover dynamic monitoring product</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">description:</span> </span></span>
<span><span class="co">#&gt; GLC_FCS30D is the first global fine land cover dynamic product at a 30-meter resolution that adopts continuous change detection. It utilizes a refined classification system containing 35 land-cover categories and covers the time span from 1985 to 2022. Before the year 2000, the update cycle was every 5 years, while after 2000, it is updated annually. In specific, it developed by combining the continuous change detection method, local adaptive updating models and the spatiotemporal optimization algorithm from dense time-series Landsat imagery, and was validated to achieve an overall accuracy of 80.88% (±0.27%) for the basic classification system 10 major land-cover types) and 73.24% (±0.30%) for the LCCS level-1 validation system (17 LCCS land-cover types).</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">field(s):</span> </span></span>
<span><span class="co">#&gt; type, id, stac_version, description, links, stac_extensions, Theme, version, doi, layer_unit, contact_name, contact_email, date_offset, sld_url, qml_url, title, extent, license, keywords, providers</span></span></code></pre></div>
<p>Now, let’s list its available items by filtering links with the <code>rel == "item"</code> attribute:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/static_functions.html">links</a></span><span class="op">(</span><span class="va">glc</span>, <span class="va">rel</span> <span class="op">==</span> <span class="st">"item"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">###Links</span></span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">links</span> (26 entries(s)):</span></span>
<span><span class="co">#&gt;  1 <span style="font-weight: bold;">[item]</span> </span></span>
<span><span class="co">#&gt; (./lc_glc.fcs30d_19850101_19851231/lc_glc.fcs30d_19850101_19851231.json)</span></span>
<span><span class="co">#&gt;  2 <span style="font-weight: bold;">[item]</span> </span></span>
<span><span class="co">#&gt; (./lc_glc.fcs30d_19900101_19901231/lc_glc.fcs30d_19900101_19901231.json)</span></span>
<span><span class="co">#&gt;  3 <span style="font-weight: bold;">[item]</span> </span></span>
<span><span class="co">#&gt; (./lc_glc.fcs30d_19950101_19951231/lc_glc.fcs30d_19950101_19951231.json)</span></span>
<span><span class="co">#&gt;  4 <span style="font-weight: bold;">[item]</span> </span></span>
<span><span class="co">#&gt; (./lc_glc.fcs30d_20000101_20001231/lc_glc.fcs30d_20000101_20001231.json)</span></span>
<span><span class="co">#&gt;  5 <span style="font-weight: bold;">[item]</span> </span></span>
<span><span class="co">#&gt; (./lc_glc.fcs30d_20010101_20011231/lc_glc.fcs30d_20010101_20011231.json)</span></span>
<span><span class="co">#&gt;  6 <span style="font-weight: bold;">[item]</span> </span></span>
<span><span class="co">#&gt; (./lc_glc.fcs30d_20020101_20021231/lc_glc.fcs30d_20020101_20021231.json)</span></span>
<span><span class="co">#&gt;  7 <span style="font-weight: bold;">[item]</span> </span></span>
<span><span class="co">#&gt; (./lc_glc.fcs30d_20030101_20031231/lc_glc.fcs30d_20030101_20031231.json)</span></span>
<span><span class="co">#&gt;  8 <span style="font-weight: bold;">[item]</span> </span></span>
<span><span class="co">#&gt; (./lc_glc.fcs30d_20040101_20041231/lc_glc.fcs30d_20040101_20041231.json)</span></span>
<span><span class="co">#&gt;  9 <span style="font-weight: bold;">[item]</span> </span></span>
<span><span class="co">#&gt; (./lc_glc.fcs30d_20050101_20051231/lc_glc.fcs30d_20050101_20051231.json)</span></span>
<span><span class="co">#&gt; 10 <span style="font-weight: bold;">[item]</span> </span></span>
<span><span class="co">#&gt; (./lc_glc.fcs30d_20060101_20061231/lc_glc.fcs30d_20060101_20061231.json)</span></span>
<span><span class="co">#&gt;   ... with 16 more link(s).</span></span></code></pre></div>
<p>To be able to filter items based on spatial and temporal attributes, we need to open them:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glc_items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/static_functions.html">read_items</a></span><span class="op">(</span><span class="va">glc</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">glc_items</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">###Items</span></span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">features</span> (26 item(s)):</span></span>
<span><span class="co">#&gt;   - lc_glc.fcs30d_19850101_19851231</span></span>
<span><span class="co">#&gt;   - lc_glc.fcs30d_19900101_19901231</span></span>
<span><span class="co">#&gt;   - lc_glc.fcs30d_19950101_19951231</span></span>
<span><span class="co">#&gt;   - lc_glc.fcs30d_20000101_20001231</span></span>
<span><span class="co">#&gt;   - lc_glc.fcs30d_20010101_20011231</span></span>
<span><span class="co">#&gt;   - lc_glc.fcs30d_20020101_20021231</span></span>
<span><span class="co">#&gt;   - lc_glc.fcs30d_20030101_20031231</span></span>
<span><span class="co">#&gt;   - lc_glc.fcs30d_20040101_20041231</span></span>
<span><span class="co">#&gt;   - lc_glc.fcs30d_20050101_20051231</span></span>
<span><span class="co">#&gt;   - lc_glc.fcs30d_20060101_20061231</span></span>
<span><span class="co">#&gt;   - ... with 16 more feature(s).</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">assets:</span> lc_glc.fcs30d_c_30m_s, qml, sld, thumbnail</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">item's fields:</span> </span></span>
<span><span class="co">#&gt; assets, bbox, collection, geometry, id, links, properties, stac_extensions, stac_version, type</span></span></code></pre></div>
<p>We have items for all dates:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/items_functions.html">items_datetime</a></span><span class="op">(</span><span class="va">glc_items</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "1985-01-01T00:00:00Z" "1990-01-01T00:00:00Z" "1995-01-01T00:00:00Z"</span></span>
<span><span class="co">#&gt;  [4] "2000-01-01T00:00:00Z" "2001-01-01T00:00:00Z" "2002-01-01T00:00:00Z"</span></span>
<span><span class="co">#&gt;  [7] "2003-01-01T00:00:00Z" "2004-01-01T00:00:00Z" "2005-01-01T00:00:00Z"</span></span>
<span><span class="co">#&gt; [10] "2006-01-01T00:00:00Z" "2007-01-01T00:00:00Z" "2008-01-01T00:00:00Z"</span></span>
<span><span class="co">#&gt; [13] "2009-01-01T00:00:00Z" "2010-01-01T00:00:00Z" "2011-01-01T00:00:00Z"</span></span>
<span><span class="co">#&gt; [16] "2012-01-01T00:00:00Z" "2013-01-01T00:00:00Z" "2014-01-01T00:00:00Z"</span></span>
<span><span class="co">#&gt; [19] "2015-01-01T00:00:00Z" "2016-01-01T00:00:00Z" "2017-01-01T00:00:00Z"</span></span>
<span><span class="co">#&gt; [22] "2018-01-01T00:00:00Z" "2019-01-01T00:00:00Z" "2020-01-01T00:00:00Z"</span></span>
<span><span class="co">#&gt; [25] "2021-01-01T00:00:00Z" "2022-01-01T00:00:00Z"</span></span></code></pre></div>
<p>To enumerate all available assets across these items, we can run:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/items_functions.html">items_assets</a></span><span class="op">(</span><span class="va">glc_items</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "lc_glc.fcs30d_c_30m_s" "qml"                   "sld"                  </span></span>
<span><span class="co">#&gt; [4] "thumbnail"</span></span></code></pre></div>
</div>
<div id="spatial-overlay" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Spatial overlay<a class="anchor" aria-label="anchor" href="#spatial-overlay"><i class="fas fa-link"></i></a>
</h2>
<p>For overlaying multiple new points with COGs, we can leverage the <code>rstac</code> function <code><a href="https://brazil-data-cube.github.io/rstac/reference/assets_functions.html">assets_url()</a></code> to retrieve the URLs of all COG files. These URLs can then be passed to an extraction function:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/assets_functions.html">assets_url</a></span><span class="op">(</span><span class="va">glc_items</span>, asset_names <span class="op">=</span> <span class="st">"lc_glc.fcs30d_c_30m_s"</span>, append_gdalvsi <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">urls</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "/vsicurl/https://s3.openlandmap.org/arco/lc_glc.fcs30d_c_30m_s_19850101_19851231_go_epsg.4326_v20231026.tif"</span></span>
<span><span class="co">#&gt; [2] "/vsicurl/https://s3.openlandmap.org/arco/lc_glc.fcs30d_c_30m_s_19900101_19901231_go_epsg.4326_v20231026.tif"</span></span>
<span><span class="co">#&gt; [3] "/vsicurl/https://s3.openlandmap.org/arco/lc_glc.fcs30d_c_30m_s_19950101_19951231_go_epsg.4326_v20231026.tif"</span></span></code></pre></div>
<p>Let’s define an extracting function. This function can extract the values in parallel:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extract_xy</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, <span class="va">cogs</span>, <span class="va">mc.cores</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">values</span> <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html">mclapply</a></span><span class="op">(</span><span class="va">cogs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">point</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span>
<span>    <span class="va">value</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html">extract</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, <span class="va">point</span><span class="op">)</span></span>
<span>    <span class="co">#dplyr::as_tibble(value)[,2]</span></span>
<span>    <span class="va">value</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">}</span>, mc.cores <span class="op">=</span> <span class="va">mc.cores</span><span class="op">)</span></span>
<span>  <span class="va">values</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>glc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This only needs URL address of the COGs on some S3 storage and then longitude and
latitude of the query points (in the WGS84 system). This is an example of query of
all land cover classes from 1985 to 2022:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu">extract_xy</span><span class="op">(</span><span class="op">-</span><span class="fl">35.5</span>, <span class="op">-</span><span class="fl">9.0</span>, <span class="va">urls</span><span class="op">)</span></span>
<span><span class="co"># add date column</span></span>
<span><span class="va">values</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/items_functions.html">items_datetime</a></span><span class="op">(</span><span class="va">glc_items</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">values</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"># A tibble: 26 × 2</span></span></span>
<span><span class="co">#&gt;     <span style="font-weight: bold;">glc</span> <span style="font-weight: bold;">date</span>      </span></span>
<span><span class="co">#&gt;   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #555555;">1</span>   130 1985-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">2</span>   130 1990-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">3</span>   130 1995-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">4</span>    10 2000-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">5</span>    10 2001-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">6</span>    10 2002-01-01</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"># ℹ 20 more rows</span></span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="openlandmap-layers.html"><span class="header-section-number">4</span> OpenLandMap layers</a></div>
<div class="next"><a href="references.html"><span class="header-section-number">6</span> References</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#openlandmap-stac"><span class="header-section-number">5</span> OpenLandMap STAC</a></li>
<li><a class="nav-link" href="#listing-layers"><span class="header-section-number">5.1</span> Listing layers</a></li>
<li><a class="nav-link" href="#spatial-overlay"><span class="header-section-number">5.2</span> Spatial overlay</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/OpenLandMap/book/blob/master/020-stac.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/OpenLandMap/book/edit/master/020-stac.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>OpenLandMap Open Land Data services</strong>" was written by OpenGeoHub foundation, GILAB.rs and contributors. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
